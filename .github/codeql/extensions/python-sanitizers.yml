# CodeQL Model Extension for Python Path Sanitizers
# Defines custom functions that sanitize user input for path operations

extensions:
  # Mark codeql_assert_path_within as a path sanitizer
  # When this function is called with a path argument, the path is considered sanitized
  - addsTo:
      pack: codeql/python-all
      extensible: sinkModel
    data: []

  - addsTo:
      pack: codeql/python-all
      extensible: sourceModel
    data: []

  # Path sanitizer: codeql_assert_path_within validates paths are within allowed directories
  # The function raises ValueError if the path escapes, so successful return means path is safe
  - addsTo:
      pack: codeql/python-all
      extensible: summaryModel
    data:
      # codeql_assert_path_within(file_path, base_dir) - sanitizes file_path
      - ["server.management.server", "", "Member[codeql_assert_path_within].Call", "", "Argument[0]", "Argument[0]", "taint"]

  # Mark the function as a barrier for path injection
  - addsTo:
      pack: codeql/python-queries
      extensible: pathInjectionSanitizer
    data:
      # Functions that validate paths
      - ["server.management.server", "Member[codeql_assert_path_within].Call.Argument[0]"]
      - ["server.management.server", "Member[secure_file_path].Call"]
